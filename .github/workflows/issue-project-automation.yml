name: Issue Project Automation
on:
    issues:
        types: [opened]
jobs:
    comment:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repo
              uses: actions/checkout@v4.1.7
            - name: Comment on new issue
              uses: actions/github-script@v7.0.1
              with:
                  github-token: ${{ secrets.MY_PAT }}
                  script: |
                      github.rest.issues.createComment({
                        issue_number: context.issue.number,
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        body: 'ðŸ‘‹ Thanks for reporting! This has been added to the project board for logging and tracking. Be sure to check out the board [here](https://github.com/users/tommerty/projects/13)'
                      })
            - name: Add issue to project board
              if: contains(github.event.issue.labels.*.name, 'bug')
              uses: actions/github-script@v7.0.1
              with:
                  github-token: ${{ secrets.MY_PAT }}
                  script: |
                      const projectId = '13';

                      try {
                        const project = await github.rest.projects.get({
                          project_id: projectId
                        });

                        if (project) {
                          await github.rest.projects.createCard({
                            column_id: project.data.columns[0].id,
                            content_id: context.issue.id,
                            content_type: 'Issue'
                          });
                        } else {
                          core.setFailed('Project not found');
                        }
                      } catch (error) {
                        core.setFailed('Failed to add issue to project board');
                      }
